name: üîç Validate Commit Messages

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  commitlint:
    name: Validate Commit Messages
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: üîç Validate commit messages
        uses: wagoid/commitlint-github-action@v6
        with:
          configFile: '.commitlintrc.json'
          token: ${{ secrets.GITHUB_TOKEN }}
          failOnWarnings: false
          helpURL: 'https://www.conventionalcommits.org/'

      - name: üìù Comment PR on failure
        if: failure() && github.event_name == 'pull_request'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const comment = `
            ## ‚ùå Validation des messages de commit √©chou√©e
            
            Vos messages de commit ne respectent pas la convention [Conventional Commits](https://www.conventionalcommits.org/).
            
            ### Format attendu :
            \`\`\`
            type(scope): description
            \`\`\`
            
            ### Types autoris√©s :
            - **feat**: nouvelle fonctionnalit√©
            - **fix**: correction de bug
            - **docs**: documentation
            - **style**: formatage, point-virgule manquant, etc.
            - **refactor**: refactoring du code
            - **test**: ajout ou modification de tests
            - **chore**: maintenance, configuration, etc.
            - **perf**: am√©lioration des performances
            - **ci**: modifications des fichiers CI
            - **build**: modifications du syst√®me de build
            - **revert**: annulation d'un commit pr√©c√©dent
            
            ### Exemples valides :
            - \`feat(auth): add user authentication\`
            - \`fix(ui): correct button alignment\`
            - \`docs: update README with installation steps\`
            - \`refactor(api): simplify user service\`
            
            Veuillez modifier vos messages de commit pour qu'ils respectent cette convention.
            `;
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });